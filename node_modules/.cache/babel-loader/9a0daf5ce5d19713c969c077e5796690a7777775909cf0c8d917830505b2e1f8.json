{"ast":null,"code":"import React,{useEffect,useState,useRef}from\"react\";import styled from\"styled-components\";import{useSelector}from\"react-redux\";import debounce from\"lodash.debounce\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LeaderboardContainer=styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 90%; /* Use percentage for responsiveness */\n  max-width: 800px;\n  margin: 20px auto;\n  background-color: #121212;\n  border-radius: 8px;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  padding: 20px;\n\n  @media (max-width: 768px) {\n    width: 95%;\n    padding: 15px;\n  }\n`;const YourRankingContainer=styled.div`\n  background-color: #222;\n  padding: 10px;\n  border-radius: 8px;\n  margin-bottom: 20px;\n  width: 100%;\n  text-align: center;\n  color: white;\n  font-size: 1rem;\n  word-break: break-all; /* Ensure long addresses wrap */\n`;const LeaderboardTitle=styled.h2`\n  text-align: center;\n  color: white;\n  margin-bottom: 20px;\n  font-size: 1.8rem;\n\n  @media (max-width: 768px) {\n    font-size: 1.6rem;\n  }\n`;const LeaderboardSubtitle=styled.h3`\n  text-align: center;\n  color: #ccc;\n  margin-bottom: 20px;\n  font-size: 1.2rem;\n\n  @media (max-width: 768px) {\n    font-size: 1rem;\n  }\n`;const LeaderboardList=styled.ul`\n  list-style: none;\n  padding: 0;\n  width: 100%;\n`;const LeaderboardItem=styled.li`\n  display: flex;\n  flex-wrap: wrap; /* Allow wrapping on small screens */\n  align-items: center;\n  padding: 10px;\n  border-bottom: 1px solid #ccc;\n  color: white;\n  background-color: ${_ref=>{let{highlight}=_ref;return highlight?\"#0059d7\":\"transparent\";}};\n\n  &:last-child {\n    border-bottom: none;\n  }\n`;const RankSpan=styled.span`\n  margin-right: 10px;\n  font-weight: bold;\n  width: 30px;\n  text-align: right;\n`;const UserSpan=styled.span`\n  flex: 1;\n  margin: 0 10px;\n  word-break: break-all;\n`;const TotalSpan=styled.span`\n  font-weight: bold;\n`;const Leaderboard=()=>{const blockchain=useSelector(state=>state.blockchain);const[leaderboard,setLeaderboard]=useState([]);const[loading,setLoading]=useState(true);const debounceRef=useRef(null);useEffect(()=>{if(!blockchain.LootBoxNFT||!blockchain.web3){console.error(\"LootBoxNFT contract is not initialized.\");return;}if(!debounceRef.current){debounceRef.current=debounce(async()=>{try{const events=await blockchain.LootBoxNFT.getPastEvents(\"RewardClaimed\",{fromBlock:0,toBlock:\"latest\"});const rewards=events.reduce((acc,event)=>{const user=event.returnValues.user;const amount=parseFloat(blockchain.web3.utils.fromWei(event.returnValues.amount,\"ether\"));acc[user]=(acc[user]||0)+amount;return acc;},{});const leaderboardData=Object.keys(rewards).map(user=>({user,total:rewards[user]}));leaderboardData.sort((a,b)=>b.total-a.total);// Limit to top 100\nsetLeaderboard(leaderboardData.slice(0,100));setLoading(false);}catch(error){console.error(\"Error fetching leaderboard data:\",error);setLoading(false);}},300);}debounceRef.current();},[blockchain.LootBoxNFT,blockchain.web3]);// Compute user's ranking from the leaderboard data\nconst userRank=blockchain.account&&leaderboard.length>0?leaderboard.findIndex(item=>item.user.toLowerCase()===blockchain.account.toLowerCase()):-1;return/*#__PURE__*/_jsxs(LeaderboardContainer,{children:[/*#__PURE__*/_jsx(LeaderboardTitle,{children:\"TOP 100 $MIKUL PACK STONERS\"}),/*#__PURE__*/_jsx(LeaderboardSubtitle,{children:\"Top wallets that have received the most $MIKUL from opening MPacks.\"}),/*#__PURE__*/_jsx(LeaderboardSubtitle,{children:\"Connect wallet to load Leaderboard.\"}),blockchain.account&&/*#__PURE__*/_jsxs(YourRankingContainer,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Your Wallet: \",blockchain.account]}),userRank>-1?/*#__PURE__*/_jsxs(\"p\",{children:[\"Your Ranking: \",/*#__PURE__*/_jsxs(\"strong\",{children:[\"#\",userRank+1]})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Your wallet is not in the Top 100.\"})]}),loading?/*#__PURE__*/_jsx(\"p\",{style:{color:\"white\",textAlign:\"center\"},children:\"Loading...\"}):/*#__PURE__*/_jsx(LeaderboardList,{children:leaderboard.map((item,index)=>/*#__PURE__*/_jsxs(LeaderboardItem,{highlight:blockchain.account&&item.user.toLowerCase()===blockchain.account.toLowerCase(),children:[/*#__PURE__*/_jsxs(RankSpan,{children:[\"#\",index+1]}),/*#__PURE__*/_jsx(UserSpan,{children:item.user}),/*#__PURE__*/_jsxs(TotalSpan,{children:[item.total.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}),\" \",\"$MIKUL\"]})]},item.user))})]});};export default Leaderboard;","map":{"version":3,"names":["React","useEffect","useState","useRef","styled","useSelector","debounce","jsx","_jsx","jsxs","_jsxs","LeaderboardContainer","div","YourRankingContainer","LeaderboardTitle","h2","LeaderboardSubtitle","h3","LeaderboardList","ul","LeaderboardItem","li","_ref","highlight","RankSpan","span","UserSpan","TotalSpan","Leaderboard","blockchain","state","leaderboard","setLeaderboard","loading","setLoading","debounceRef","LootBoxNFT","web3","console","error","current","events","getPastEvents","fromBlock","toBlock","rewards","reduce","acc","event","user","returnValues","amount","parseFloat","utils","fromWei","leaderboardData","Object","keys","map","total","sort","a","b","slice","userRank","account","length","findIndex","item","toLowerCase","children","style","color","textAlign","index","toLocaleString","undefined","minimumFractionDigits","maximumFractionDigits"],"sources":["C:/Users/deanw/OneDrive/Desktop/GitHub/tribepacks/src/components/Leaderboard.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { useSelector } from \"react-redux\";\r\nimport debounce from \"lodash.debounce\";\r\n\r\nconst LeaderboardContainer = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  width: 90%; /* Use percentage for responsiveness */\r\n  max-width: 800px;\r\n  margin: 20px auto;\r\n  background-color: #121212;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\r\n  padding: 20px;\r\n\r\n  @media (max-width: 768px) {\r\n    width: 95%;\r\n    padding: 15px;\r\n  }\r\n`;\r\n\r\nconst YourRankingContainer = styled.div`\r\n  background-color: #222;\r\n  padding: 10px;\r\n  border-radius: 8px;\r\n  margin-bottom: 20px;\r\n  width: 100%;\r\n  text-align: center;\r\n  color: white;\r\n  font-size: 1rem;\r\n  word-break: break-all; /* Ensure long addresses wrap */\r\n`;\r\n\r\nconst LeaderboardTitle = styled.h2`\r\n  text-align: center;\r\n  color: white;\r\n  margin-bottom: 20px;\r\n  font-size: 1.8rem;\r\n\r\n  @media (max-width: 768px) {\r\n    font-size: 1.6rem;\r\n  }\r\n`;\r\n\r\nconst LeaderboardSubtitle = styled.h3`\r\n  text-align: center;\r\n  color: #ccc;\r\n  margin-bottom: 20px;\r\n  font-size: 1.2rem;\r\n\r\n  @media (max-width: 768px) {\r\n    font-size: 1rem;\r\n  }\r\n`;\r\n\r\nconst LeaderboardList = styled.ul`\r\n  list-style: none;\r\n  padding: 0;\r\n  width: 100%;\r\n`;\r\n\r\nconst LeaderboardItem = styled.li`\r\n  display: flex;\r\n  flex-wrap: wrap; /* Allow wrapping on small screens */\r\n  align-items: center;\r\n  padding: 10px;\r\n  border-bottom: 1px solid #ccc;\r\n  color: white;\r\n  background-color: ${({ highlight }) => (highlight ? \"#0059d7\" : \"transparent\")};\r\n\r\n  &:last-child {\r\n    border-bottom: none;\r\n  }\r\n`;\r\n\r\nconst RankSpan = styled.span`\r\n  margin-right: 10px;\r\n  font-weight: bold;\r\n  width: 30px;\r\n  text-align: right;\r\n`;\r\n\r\nconst UserSpan = styled.span`\r\n  flex: 1;\r\n  margin: 0 10px;\r\n  word-break: break-all;\r\n`;\r\n\r\nconst TotalSpan = styled.span`\r\n  font-weight: bold;\r\n`;\r\n\r\nconst Leaderboard = () => {\r\n  const blockchain = useSelector((state) => state.blockchain);\r\n  const [leaderboard, setLeaderboard] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const debounceRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!blockchain.LootBoxNFT || !blockchain.web3) {\r\n      console.error(\"LootBoxNFT contract is not initialized.\");\r\n      return;\r\n    }\r\n\r\n    if (!debounceRef.current) {\r\n      debounceRef.current = debounce(async () => {\r\n        try {\r\n          const events = await blockchain.LootBoxNFT.getPastEvents(\"RewardClaimed\", {\r\n            fromBlock: 0,\r\n            toBlock: \"latest\",\r\n          });\r\n\r\n          const rewards = events.reduce((acc, event) => {\r\n            const user = event.returnValues.user;\r\n            const amount = parseFloat(\r\n              blockchain.web3.utils.fromWei(event.returnValues.amount, \"ether\")\r\n            );\r\n            acc[user] = (acc[user] || 0) + amount;\r\n            return acc;\r\n          }, {});\r\n\r\n          const leaderboardData = Object.keys(rewards).map((user) => ({\r\n            user,\r\n            total: rewards[user],\r\n          }));\r\n\r\n          leaderboardData.sort((a, b) => b.total - a.total);\r\n\r\n          // Limit to top 100\r\n          setLeaderboard(leaderboardData.slice(0, 100));\r\n          setLoading(false);\r\n        } catch (error) {\r\n          console.error(\"Error fetching leaderboard data:\", error);\r\n          setLoading(false);\r\n        }\r\n      }, 300);\r\n    }\r\n\r\n    debounceRef.current();\r\n  }, [blockchain.LootBoxNFT, blockchain.web3]);\r\n\r\n  // Compute user's ranking from the leaderboard data\r\n  const userRank =\r\n    blockchain.account && leaderboard.length > 0\r\n      ? leaderboard.findIndex(\r\n          (item) =>\r\n            item.user.toLowerCase() === blockchain.account.toLowerCase()\r\n        )\r\n      : -1;\r\n\r\n  return (\r\n    <LeaderboardContainer>\r\n      <LeaderboardTitle>TOP 100 $MIKUL PACK STONERS</LeaderboardTitle>\r\n      <LeaderboardSubtitle>\r\n        Top wallets that have received the most $MIKUL from opening MPacks.\r\n      </LeaderboardSubtitle>\r\n      <LeaderboardSubtitle>\r\n        Connect wallet to load Leaderboard.\r\n      </LeaderboardSubtitle>\r\n\r\n      {/* Display connected user's wallet and ranking */}\r\n      {blockchain.account && (\r\n        <YourRankingContainer>\r\n          <p>Your Wallet: {blockchain.account}</p>\r\n          {userRank > -1 ? (\r\n            <p>\r\n              Your Ranking: <strong>#{userRank + 1}</strong>\r\n            </p>\r\n          ) : (\r\n            <p>Your wallet is not in the Top 100.</p>\r\n          )}\r\n        </YourRankingContainer>\r\n      )}\r\n\r\n      {loading ? (\r\n        <p style={{ color: \"white\", textAlign: \"center\" }}>Loading...</p>\r\n      ) : (\r\n        <LeaderboardList>\r\n          {leaderboard.map((item, index) => (\r\n            <LeaderboardItem\r\n              key={item.user}\r\n              highlight={\r\n                blockchain.account &&\r\n                item.user.toLowerCase() === blockchain.account.toLowerCase()\r\n              }\r\n            >\r\n              <RankSpan>#{index + 1}</RankSpan>\r\n              <UserSpan>{item.user}</UserSpan>\r\n              <TotalSpan>\r\n                {item.total.toLocaleString(undefined, {\r\n                  minimumFractionDigits: 2,\r\n                  maximumFractionDigits: 2,\r\n                })}{\" \"}\r\n                $MIKUL\r\n              </TotalSpan>\r\n            </LeaderboardItem>\r\n          ))}\r\n        </LeaderboardList>\r\n      )}\r\n    </LeaderboardContainer>\r\n  );\r\n};\r\n\r\nexport default Leaderboard;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}